================================================================================
MULTI-GPU TEST: Qwen 2.5 1.5B on 2x L40S
================================================================================

1. Getting training session...

2. Initializing Qwen/Qwen2.5-1.5B...

âœ“ Initialized in 29.34s
  Model: Qwen/Qwen2.5-1.5B
  Trainable params: 36,929,536
  Total params: 925,545,984
  GPUs: 1

3. Running 5 training iterations...
--------------------------------------------------------------------------------
Traceback (most recent call last):
  File "/Users/arav/Desktop/Coding/wright/signal/test_multigpu_now.py", line 139, in <module>
    asyncio.run(main())
    ~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/arav/Desktop/Coding/wright/signal/test_multigpu_now.py", line 64, in main
    fb_result = await session.forward_backward.remote.aio(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
    )
    ^
  File "/opt/homebrew/lib/python3.13/site-packages/modal/_object.py", line 304, in wrapped
    return await method(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.13/site-packages/modal/_functions.py", line 1722, in remote
    return await self._call_function(args, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.13/site-packages/modal/_functions.py", line 1666, in _call_function
    return await invocation.run_function()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.13/site-packages/modal/_functions.py", line 300, in run_function
    return await _process_result(item.result, item.data_format, self.stub, self.client)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.13/site-packages/modal/_utils/function_utils.py", line 518, in _process_result
    raise exc_with_hints(exc)
  File "<ta-01K7FMT41DGK6MFWD51CK90RJQ>:/root/training_session.py", line 409, in forward_backward
  File "<ta-01K7FMT41DGK6MFWD51CK90RJQ>:/root/modal_runtime/utils/training.py", line 41, in compute_forward_backward
  File "<ta-01K7FMT41DGK6MFWD51CK90RJQ>:/root/modal_runtime/loss_functions.py", line 165, in compute_loss
  File "<ta-01K7FMT41DGK6MFWD51CK90RJQ>:/root/modal_runtime/loss_functions.py", line 13, in causal_lm_loss
  File "<ta-01K7FMT41DGK6MFWD51CK90RJQ>:/usr/local/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
  File "<ta-01K7FMT41DGK6MFWD51CK90RJQ>:/usr/local/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
  File "<ta-01K7FMT41DGK6MFWD51CK90RJQ>:/usr/local/lib/python3.12/site-packages/torch/nn/parallel/data_parallel.py", line 178, in forward
RuntimeError: module must have its parameters and buffers on device cuda:0 (device_ids[0]) but found one of them on device: cuda:1
